import StoryModel from"./StoryModel.js";import StoryPresenter from"./StoryPresenter.js";const VAPID_PUBLIC_KEY="BCCs2eonMI-6H2ctvFaWg-UYdDv387Vno_bzUzALpB442r2lCnsHmtrx8biyPi_E-1fSGABK_Qs_GlvPoJJqxbk",Profile={renderProfile(){const e=localStorage.getItem("token"),t=localStorage.getItem("userId"),i=localStorage.getItem("name");let n=null;if(!e)return StoryPresenter.showNotification("Please login to view your profile",!0),void(window.location.hash="#/");const o=document.getElementById("app"),s=i?i.charAt(0).toUpperCase():"U";o.innerHTML=`\n      <div class="profile-container">\n        <div class="profile-header">\n          <div class="profile-avatar">${s}</div>\n          <h2 class="profile-name">${i||"User"}</h2>\n          <p class="profile-email">User ID: ${t||"Unknown"}</p>\n        </div>\n        \n        <div class="notifications-section">\n          <h3>Push Notifications</h3>\n          <p>Get notified when your stories are published.</p>\n          \n          <div class="toggle-container">\n            <label class="toggle-switch">\n              <input type="checkbox" id="notifications-toggle">\n              <span class="slider"></span>\n            </label>\n            <span>Enable Push Notifications</span>\n          </div>\n        </div>\n      </div>\n    `;const r=document.getElementById("notifications-toggle");"serviceWorker"in navigator&&"PushManager"in window?navigator.serviceWorker.register("/service-worker.js").then((async e=>{const t=await e.pushManager.getSubscription();t&&(n=t,r.checked=!0),r.addEventListener("change",(async()=>{if(r.checked)try{const t=await e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:StoryPresenter.urlBase64ToUint8Array(VAPID_PUBLIC_KEY)});n=t,await StoryModel.subscribeNotification(t),StoryPresenter.showNotification("Push notifications enabled")}catch(e){r.checked=!1,StoryPresenter.showNotification("Failed to enable push notifications: "+e.message,!0)}else try{n&&(await StoryModel.unsubscribeNotification(n),await n.unsubscribe(),n=null,StoryPresenter.showNotification("Push notifications disabled"))}catch(e){StoryPresenter.showNotification("Failed to disable push notifications: "+e.message,!0)}}))})).catch((e=>{console.error("Service Worker registration failed:",e),r.disabled=!0,r.parentElement.nextElementSibling.textContent="Push notifications not available"})):(r.disabled=!0,r.parentElement.nextElementSibling.textContent="Push notifications not supported on this browser")}};export default Profile;